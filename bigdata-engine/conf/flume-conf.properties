# ??????
agent1.sources = source1
agent1.sinks = sink_hdfs sink_kafka
agent1.channels = channel_memory channel_file

# --- 1. Source: ???????? ---
agent1.sources.source1.type = spooldir
agent1.sources.source1.spoolDir = F:/Project/video-analysis-and-recommendation-system/video-analysis-and-recommendation-system/bigdata-engine/logs
agent1.sources.source1.fileHeader = true
agent1.sources.source1.consumeOrder = oldest
# ???????????????????
agent1.sources.source1.completedSuffix = .completed
agent1.sources.source1.ignorePattern = ^.*\\.tmp$

# --- 2. Channels: ?????? ---
# ???????? HDFS ??????????????
agent1.channels.channel_memory.type = memory
agent1.channels.channel_memory.capacity = 10000
agent1.channels.channel_memory.transactionCapacity = 1000

# ???????? Kafka ???????????????????
agent1.channels.channel_file.type = file
agent1.channels.channel_file.checkpointDir = F:/Project/flume_data/checkpoint
agent1.channels.channel_file.dataDirs = F:/Project/flume_data/data

# --- 3. Sink 1: HDFS (??????) ---
agent1.sinks.sink_hdfs.type = hdfs
agent1.sinks.sink_hdfs.hdfs.path = hdfs://localhost:9000/short-video/behavior/logs/%Y-%m-%d
agent1.sinks.sink_hdfs.hdfs.filePrefix = behavior_log_
agent1.sinks.sink_hdfs.hdfs.fileSuffix = .json
# ????????????? %Y-%m-%d
agent1.sinks.sink_hdfs.hdfs.useLocalTimeStamp = true
# ?????? 128MB ? ? 10?? ??????
agent1.sinks.sink_hdfs.hdfs.rollInterval = 600
agent1.sinks.sink_hdfs.hdfs.rollSize = 134217728
agent1.sinks.sink_hdfs.hdfs.rollCount = 0

# --- 4. Sink 2: Kafka (??????) ---
agent1.sinks.sink_kafka.type = org.apache.flume.sink.kafka.KafkaSink
agent1.sinks.sink_kafka.kafka.bootstrap.servers = localhost:9092
agent1.sinks.sink_kafka.kafka.topic = shortvideo_user_behavior
agent1.sinks.sink_kafka.kafka.producer.acks = 1
agent1.sinks.sink_kafka.kafka.producer.linger.ms = 1

# --- 5. ???? (Replicating ??) ---
# ?????????source1 ?????????? channel
agent1.sources.source1.channels = channel_memory channel_file
agent1.sinks.sink_hdfs.channel = channel_memory
agent1.sinks.sink_kafka.channel = channel_file