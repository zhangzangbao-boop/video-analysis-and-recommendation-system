# ????
app {
  name = "ShortVideoRecommendation"
  env = "dev"
  logLevel = "WARN"

  checkpoint {
    enabled = true
    path = "/tmp/shortvideo/checkpoint"
  }
}

# Spark??
spark {
  master = "local[*]"
  app.name = ${app.name}
  executor.memory = "2g"
  executor.cores = 2
  driver.memory = "2g"

  sql.shuffle.partitions = 200
  streaming.blockInterval = 200
  streaming.kafka.maxRatePerPartition = 1000

  enableHiveSupport = false  # Windows???????
  logLevel = ${app.logLevel}
}

# Kafka??
kafka {
  bootstrap.servers = "localhost:9092"

  group.id = "shortvideo-recommendation"
  auto.offset.reset = "latest"
  enable.auto.commit = true
  auto.commit.interval.ms = 5000
  session.timeout.ms = 30000
  max.poll.records = 500
  max.poll.interval.ms = 300000

  producer {
    acks = "1"
    retries = 3
    batch.size = 16384
    linger.ms = 1
    buffer.memory = 33554432
    compression.type = "snappy"
  }

  consumer {
    enable.auto.commit = false
    auto.offset.reset = "earliest"
  }

  security {
    enabled = false
  }

  topics {
    user-behavior = "shortvideo_user_behavior"
    content-exposure = "shortvideo_content_exposure"
    user-interaction = "shortvideo_user_interaction"
    recommend-result = "shortvideo_recommend_result"
  }
}

# Redis??
redis {
  host = "localhost"
  port = 6379
  password = ""
  database = 0
  timeout = 2000

  max.total = 50
  max.idle = 10
  min.idle = 5
}

# HDFS??????????????
hdfs {
  base.path = "file:///tmp/shortvideo"  # Windows??file://

  ods.path = ${hdfs.base.path}"/ods"
  dwd.path = ${hdfs.base.path}"/dwd"
  dws.path = ${hdfs.base.path}"/dws"
  ads.path = ${hdfs.base.path}"/ads"

  model.path = ${hdfs.base_path}"/models"
  log.path = ${hdfs.base.path}"/logs"
}

# ??????
recommendation {
  als {
    rank = 20
    maxIter = 10
    regParam = 0.01
    implicitPrefs = true
    alpha = 1.0
  }

  topN = 100
  similarVideosCount = 50
  hotVideosCount = 1000

  minRating = 0.1
  maxRating = 5.0
}

# ??????
behavior.weight {
  view = 1.0
  like = 2.0
  comment = 3.0
  share = 4.0
  collect = 3.0
  follow = 5.0
  unfollow = -5.0
}