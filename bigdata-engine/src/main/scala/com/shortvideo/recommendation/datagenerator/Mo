  /**
   * 生成高质量数据集，专门为ALS模型训练优化
   * 确保满足用户行为>=5和视频互动>=5的过滤条件
   */
  private def generateHighQualityData(generator: LogGenerator, count: Int, filePath: String): Unit = {
    println(s"[INFO] 开始生成 $count 条高质量训练数据到文件: $filePath")
    println(s"[INFO] 此数据集专门优化用于满足ALS模型训练的数据质量要求")
    println(s"[INFO] 确保每个用户至少有5个行为，某些视频至少有5次互动")
    
    val behaviors = generator.generateHighQualityDataSet(count)
    val writer = new BufferedWriter(new FileWriter(filePath))
    
    try {
      for ((userBehavior, i) <- behaviors.zipWithIndex) {
        val jsonLog = generator.generateJsonLog(userBehavior)
        writer.write(jsonLog)
        writer.newLine()
        
        if ((i + 1) % 100 == 0) {
          println(s"[PROGRESS] 已生成 ${i + 1} 条数据...")
        }
      }
    } finally {
      writer.close()
    }
    
    println(s"[INFO] 成功生成 ${behaviors.length} 条高质量训练数据到文件: $filePath")
    println(s"[INFO] 数据特点: 增强了用户行为重复度和视频互动频率，更适合ALS模型训练")
    
    // 输出统计信息
    val userStats = behaviors.groupBy(_.userId).view.mapValues(_.size).toMap
    val videoStats = behaviors.groupBy(_.videoId).view.mapValues(_.size).toMap
    val minUserBehaviors = userStats.values.min
    val minVideoBehaviors = videoStats.values.min
    val avgUserBehaviors = userStats.values.sum.toDouble / userStats.size
    val avgVideoBehaviors = videoStats.values.sum.toDouble / videoStats.size
    
    println(s"[STATS] 用户行为统计 - 最少: $minUserBehaviors, 平均: ${avgUserBehaviors.formatted("%.2f")}, 总用户: ${userStats.size}")
    println(s"[STATS] 视频互动统计 - 最少: $minVideoBehaviors, 平均: ${avgVideoBehaviors.formatted("%.2f")}, 总视频: ${videoStats.size}")
  }