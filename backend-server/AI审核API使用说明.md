# AI审核API使用说明

## 功能概述

已实现基于腾讯云内容安全API的AI视频审核功能，支持：
- ✅ 文本内容审核（标题、描述、标签）
- ✅ 图片内容审核（封面）
- ✅ 违规内容标注
- ✅ 风险等级评估
- ✅ 管理员界面一键分析

## 配置说明

### 1. 腾讯云内容安全配置

在 `application.yml` 中已添加配置：

```yaml
tencent:
  cms:
    region: ap-guangzhou  # 内容安全地域（与COS地域相同）
```

**注意**：使用与COS相同的 `secret-id` 和 `secret-key`，无需额外配置。

### 2. 开通腾讯云内容安全服务

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 进入「内容安全」服务
3. 开通服务（有免费额度）
4. 确保API密钥有内容安全权限

## 使用方法

### 管理员界面操作

1. 进入「视频管理」页面
2. 点击「审核/预览」打开视频详情
3. 在「AI智能分析」区域点击「开始AI分析」按钮
4. 等待AI分析完成（通常3-10秒）
5. 查看分析结果：
   - 审核建议（通过/驳回/人工审核）
   - 风险等级（低/中/高）
   - 风险分数（0-100）
   - 违规标注详情
6. 可选择「采纳AI建议」快速操作

### API接口

**接口地址**：`POST /api/admin/video/{id}/ai-audit`

**请求示例**：
```bash
curl -X POST http://localhost:8090/api/admin/video/123/ai-audit \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**响应示例**：
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "passed": false,
    "suggestion": "REJECT",
    "riskLevel": "HIGH",
    "riskScore": 85,
    "message": "AI检测到违规内容：色情内容（置信度：85%）",
    "violations": [
      {
        "type": "porn",
        "typeName": "色情内容",
        "confidence": 85,
        "description": "色情内容，建议驳回",
        "location": "cover"
      }
    ]
  }
}
```

## 审核结果说明

### 建议操作（suggestion）

- **PASS**：建议通过，内容正常
- **REJECT**：建议驳回，存在严重违规
- **REVIEW**：建议人工审核，需要进一步判断

### 风险等级（riskLevel）

- **LOW**：低风险，风险分数 < 50
- **MEDIUM**：中风险，风险分数 50-80
- **HIGH**：高风险，风险分数 > 80

### 违规类型（type）

- **porn**：色情内容
- **violence**：暴力内容
- **politics**：政治敏感
- **terrorism**：暴恐内容
- **abuse**：辱骂内容
- **illegal**：违法违规
- **spam**：垃圾信息
- **ad**：广告内容

## 降级方案

如果腾讯云API调用失败，系统会自动降级：

1. **API调用失败**：返回"建议人工审核"
2. **配置缺失**：使用简单的关键词过滤（SimpleContentAuditUtil）
3. **网络异常**：提示管理员手动审核

## 费用说明

- **免费额度**：腾讯云内容安全提供免费额度
- **超出后**：按调用量计费，价格较低
- **建议**：合理使用，避免频繁重复分析

## 注意事项

1. **API密钥安全**：不要将密钥提交到公开仓库
2. **审核准确性**：AI审核仅供参考，最终由管理员决定
3. **响应时间**：AI分析需要3-10秒，请耐心等待
4. **网络要求**：需要能够访问腾讯云API

## 故障排查

### 问题1：AI分析失败

**可能原因**：
- 腾讯云API密钥配置错误
- 未开通内容安全服务
- 网络连接问题

**解决方法**：
1. 检查 `application.yml` 中的密钥配置
2. 确认已开通腾讯云内容安全服务
3. 检查网络连接

### 问题2：分析结果不准确

**说明**：AI审核存在误判可能，建议：
- 高风险内容：仔细人工复核
- 中风险内容：结合其他信息判断
- 低风险内容：可快速通过

### 问题3：API调用超时

**解决方法**：
- 检查网络连接
- 稍后重试
- 使用降级方案（关键词过滤）

## 后续优化

1. **缓存机制**：相同视频不重复分析
2. **批量分析**：支持批量视频AI审核
3. **分析历史**：记录AI分析历史记录
4. **自定义规则**：支持自定义审核规则

---

**版本**：v1.0  
**创建时间**：2024  
**维护者**：开发团队
